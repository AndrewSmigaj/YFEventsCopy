<!DOCTYPE html>
<html>
<head>
    <title>Debug Send Button</title>
    <script>
        // Debug event binding
        window.addEventListener('DOMContentLoaded', () => {
            console.log('=== Event Binding Debug ===');
            
            // Check for message form
            const messageForm = document.getElementById('message-form');
            console.log('message-form found:', !!messageForm);
            
            // Check for message input
            const messageInput = document.getElementById('message-input');
            console.log('message-input found:', !!messageInput);
            
            // Check for submit button
            const submitButton = document.querySelector('#message-form button[type="submit"]');
            console.log('Submit button found:', !!submitButton);
            
            // Check if CommunicationApp exists
            console.log('CommunicationApp exists:', typeof CommunicationApp !== 'undefined');
            
            // Try to check event listeners
            if (messageForm) {
                // Test form submission
                messageForm.addEventListener('submit', (e) => {
                    console.log('Form submit event fired!');
                    e.preventDefault();
                });
                
                // Check if form is visible
                console.log('Form is visible:', messageForm.offsetParent !== null);
                console.log('Form parent display:', window.getComputedStyle(messageForm.parentElement).display);
            }
            
            if (submitButton) {
                // Test button click
                submitButton.addEventListener('click', (e) => {
                    console.log('Button click event fired!');
                });
                
                console.log('Button text:', submitButton.textContent);
                console.log('Button is visible:', submitButton.offsetParent !== null);
            }
            
            // Check iframe context
            if (window.parent !== window) {
                console.log('Running in iframe');
                
                // Wait for app initialization
                setTimeout(() => {
                    if (typeof CommunicationApp !== 'undefined') {
                        console.log('CommunicationApp initialized');
                        console.log('Current channel:', CommunicationApp.currentChannel);
                        console.log('bindEvents exists:', typeof CommunicationApp.bindEvents === 'function');
                    }
                }, 1000);
            }
        });
    </script>
</head>
<body>
    <h1>Check Console for Debug Info</h1>
    <iframe src="/communication/embedded?seller_id=1" style="width: 100%; height: 600px; border: 1px solid #ccc;"></iframe>
    
    <script>
        // Monitor iframe
        const iframe = document.querySelector('iframe');
        iframe.onload = () => {
            console.log('=== Checking iframe content ===');
            try {
                const iframeDoc = iframe.contentDocument;
                const iframeWindow = iframe.contentWindow;
                
                // Check elements in iframe
                const form = iframeDoc.getElementById('message-form');
                const input = iframeDoc.getElementById('message-input');
                const button = iframeDoc.querySelector('#message-form button[type="submit"]');
                
                console.log('In iframe - form found:', !!form);
                console.log('In iframe - input found:', !!input);
                console.log('In iframe - button found:', !!button);
                
                if (button) {
                    console.log('Button HTML:', button.outerHTML);
                    console.log('Button parent visible:', button.parentElement.style.display);
                    console.log('Form parent visible:', form.parentElement.style.display);
                }
                
                // Check if events are bound
                setTimeout(() => {
                    if (iframeWindow.CommunicationApp) {
                        console.log('App channels:', iframeWindow.CommunicationApp.channels.length);
                        console.log('Current channel:', iframeWindow.CommunicationApp.currentChannel);
                    }
                }, 2000);
                
            } catch (e) {
                console.error('Cannot access iframe:', e);
            }
        };
    </script>
</body>
</html>