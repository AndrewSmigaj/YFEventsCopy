YFEVENTS QUICK DEPLOYMENT GUIDE FOR UBUNTU 22.04
================================================

PREREQUISITES
-------------
- Fresh Ubuntu 22.04 server (2GB RAM minimum)
- Domain name pointed to your server's IP address
- Root or sudo access to the server


STEP 1: DOWNLOAD AND RUN SERVER SETUP
-------------------------------------

# SSH into your server and run from your home directory
cd ~

# Download the setup script
wget https://raw.githubusercontent.com/AndrewSmigaj/YFEventsCopy/refactor/unified-structure/scripts/deploy/setup-server.sh

# Make it executable
chmod +x setup-server.sh

# Run the setup
sudo ./setup-server.sh

When prompted, provide:
- Domain name: yourdomain.com (use your actual domain)
- Email for SSL: your-email@example.com (for Let's Encrypt certificates)
- MySQL password for yfevents user: Choose a secure password and remember it!


STEP 2: COMPLETE MYSQL SETUP (if needed)
----------------------------------------

# If the setup script had issues with MySQL, run the fix script:
cd /var/www/yfevents
sudo ./scripts/deploy/fix-mysql-setup.sh

# Enter your chosen MySQL password when prompted


STEP 3: CLONE AND DEPLOY
------------------------

# Clone the repository with the correct branch
sudo git clone -b refactor/unified-structure https://github.com/AndrewSmigaj/YFEventsCopy.git /var/www/yfevents

# Navigate to the cloned directory
cd /var/www/yfevents

# Create deployment config from example
sudo cp config/deployment/deployment.yaml.example config/deployment/deployment.yaml

# Edit the configuration file
sudo nano config/deployment/deployment.yaml

# Update these values in the file:
# - server_name: yourdomain.com (line ~134)
# - server_admin: admin@yourdomain.com (line ~135)
# Save and exit (Ctrl+X, Y, Enter)

# Run the deployment
sudo ./scripts/deploy/deploy.sh


STEP 4: FOLLOW DEPLOYMENT PROMPTS
---------------------------------

The deploy script will ask for:
- Database password: Use the same password from Step 1
- Admin user details: Create your admin account
  - Username (e.g., admin)
  - Email (e.g., admin@yourdomain.com)
  - Password (choose a secure password)


POST-DEPLOYMENT TASKS
--------------------

1. Install Modules (Required):
   cd /var/www/yfevents
   sudo -u www-data php modules/install.php yfauth
   sudo -u www-data php modules/install.php yfclaim
   sudo -u www-data php modules/install.php yftheme

2. Verify Installation:
   # Check site health
   sudo -u www-data php scripts/deploy/health-check.php
   
   # Verify cron job was added
   sudo crontab -u www-data -l

3. Configure Google Maps (Optional):
   # Edit .env file to add your Google Maps API key
   sudo nano .env
   # Add: GOOGLE_MAPS_API_KEY=your-api-key-here


ACCESS YOUR SITE
----------------

- Main site: https://yourdomain.com
- Admin panel: https://yourdomain.com/admin/
- Event calendar: https://yourdomain.com/calendar.php
- Local shops: https://yourdomain.com/calendar.php#shops


QUICK TROUBLESHOOTING
--------------------

Permission errors:
  sudo chown -R www-data:www-data /var/www/yfevents
  sudo chmod -R 755 storage/

MySQL connection issues:
  cd /var/www/yfevents
  sudo ./scripts/deploy/fix-mysql-setup.sh

Check error logs:
  sudo tail -f /var/log/apache2/error.log
  sudo tail -f /var/www/yfevents/storage/logs/yfevents.log

SSL certificate issues:
  sudo certbot renew --dry-run  # Test renewal
  sudo certbot renew --force-renewal  # Force renewal

Module not working:
  # Check if module is registered
  mysql -u yfevents -p yakima_finds -e "SELECT * FROM modules;"


NOTES
-----
- The setup script installs Apache, PHP 8.x, MySQL, and all dependencies
- SSL certificates are automatically configured via Let's Encrypt
- Event scraping runs automatically every 6 hours via cron
- For detailed deployment options, see DEPLOYMENT_GUIDE.md